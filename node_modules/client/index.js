var ShipFactory = require("ship");
/* --- Client --- */

function Client(socket) {
    this.id = Math.random();
    this.ship = ShipFactory.CreateShip(),
    this.score = 0;
    this.input = {
        clicked: false,
        x: 0,
        y: 0
    };
    this.socket = socket;
    this.projectiles = [];
    this.rocketsActive = 0;
    this.rocketCooldown = 0;
}

Client.prototype.AddRequestHandler = function(type, handler) {
    this.socket.on(type, handler);
};

Client.prototype.Send = function(type, data) {
    this.socket.emit(type, data);
};

Client.prototype.ProcessInput = function() {
    if (this.input.clicked) {
        this.ship.Fire(this.projectiles);
    }
    if (this.input.rocket && this.rocketsActive < 2 && this.rocketCooldown < 0) {
        this.ship.Rocket(this.projectiles);
        this.rocketsActive++;
        this.rocketCooldown = 50;
    }
    this.rocketCooldown--;
    this.ship.CalculateDirections(this.input);
    this.ship.MoveShip();
    this.ship.PreventGoingOutOfScreen();
};

/* --- ClientFactory --- */

function ClientFactory() {}

ClientFactory.prototype.CreateClient = function(socket) {
    return new Client(socket);
};

/* --- Exports --- */

module.exports = new ClientFactory();
